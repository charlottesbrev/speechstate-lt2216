(this.webpackJsonpspeechstate=this.webpackJsonpspeechstate||[]).push([[0],{170:function(t,e,n){},218:function(t,e){},357:function(t,e){},360:function(t,e){},364:function(t,e){},365:function(t,e){},366:function(t,e){},367:function(t,e){},368:function(t,e){},456:function(t,e,n){"use strict";n.r(e);var c=n(166),a=n(51),r=(n(170),n(14),n(159)),s=n(25),o=n(94),i=n(3),u=n(459),l=n(460);function p(t){return Object(i.q)((function(e){return{type:"SPEAK",value:t}}))}var h={"Yes.":{acknowledge:"yes"},"No.":{acknowledge:"no"},"Of course.":{acknowledge:"yes"},"No way.":{acknowledge:"no"},You:{isStarting:"computer"},"You can start.":{isStarting:"computer"},"I.":{isStarting:"player"},"I want to start.":{isStarting:"player"},"One.":{selectedMatches:1},"1.":{selectedMatches:1},"One match.":{selectedMatches:1},"One stick.":{selectedMatches:1},"I pick one.":{selectedMatches:1},"I pick one match.":{selectedMatches:1},"I pick one stick.":{selectedMatches:1},"I take one.":{selectedMatches:1},"I take one match.":{selectedMatches:1},"I take one stick.":{selectedMatches:1},"Two.":{selectedMatches:2},"2.":{selectedMatches:2},"Two matches.":{selectedMatches:2},"Two sticks.":{selectedMatches:2},"I pick two.":{selectedMatches:2},"I pick two matches.":{selectedMatches:2},"I pick two sticks.":{selectedMatches:2},"I take two.":{selectedMatches:2},"I take two matches.":{selectedMatches:2},"I take two sticks.":{selectedMatches:2},"Three.":{selectedMatches:3},"3.":{selectedMatches:3},"Three matches.":{selectedMatches:3},"Three sticks.":{selectedMatches:3},"I pick three.":{selectedMatches:3},"I pick three matches.":{selectedMatches:3},"I pick three sticks.":{selectedMatches:3},"I take three.":{selectedMatches:3},"I take three matches.":{selectedMatches:3},"I take three sticks.":{selectedMatches:3}};function d(t){return"Yes."===t||"Of course."===t}function f(t){return"No."===t||"No way."===t}var E={initial:"idle",states:{idle:{on:{CLICK:{target:"init",actions:Object(i.b)({threshold:function(t){return.8}})}}},init:{on:{TTS_READY:"welcome_to_game",CLICK:"welcome_to_game"}},welcome_to_game:{initial:"start",on:{ENDSPEECH:"login"},states:{start:{entry:p("Hello and welcome to the 10 matches game.")}}},login:{initial:"reset",on:{RECOGNISED:[{target:".helpme",cond:function(t){return"Help."===t.recResult[0].utterance}},{target:"unsure_of_login",cond:function(t){return t.recResult[0].confidence<t.threshold}},{target:"set_username"}],HELPME:"init",TIMEOUT:[{target:"idle",cond:function(t){return t.sentenceCounter>=t.sentences.length}},{target:".prompt"}]},states:{reset:{entry:[Object(i.b)({sentenceCounter:function(t){return 0}}),Object(i.b)({sentences:function(t){return["What is your name?","Please tell me your name.","Tell me your name, for example Mark."]}})],always:"prompt"},helpme:{entry:p("This is some help 1."),on:{ENDSPEECH:{actions:Object(i.q)("HELPME")}}},prompt:{entry:[Object(i.q)((function(t){return{type:"SPEAK",value:t.sentences[t.sentenceCounter]}}))],on:{ENDSPEECH:{target:"wait_for_name",actions:Object(i.b)({sentenceCounter:function(t){return t.sentenceCounter+1}})}}},wait_for_name:{entry:Object(i.q)("LISTEN")},nomatch:{entry:p("Sorry, I don't know what it is. Tell me your name."),on:{ENDSPEECH:"wait_for_name"}}}},unsure_of_login:{initial:"first_question",on:{RECOGNISED:[{target:".yes",cond:function(t){return d(t.recResult[0].utterance)}},{target:".no",cond:function(t){return f(t.recResult[0].utterance)}},{target:".nomatch"}],COMPUTER_RIGHT:{target:"set_username",actions:[Object(i.b)({recResult:function(t){return t.saved}})]},COMPUTER_WRONG:{target:"login",actions:Object(i.b)({recResult:function(t){return t.saved}})},TIMEOUT:".repeat_question"},states:{first_question:{entry:[Object(i.b)({saved:function(t){return t.recResult}}),Object(i.q)((function(t){return{type:"SPEAK",value:"Did you say: ".concat(t.recResult[0].utterance,"?")}}))],on:{ENDSPEECH:{actions:Object(i.q)("LISTEN")}}},repeat_question:{entry:[Object(i.q)((function(t){return{type:"SPEAK",value:"Did you say: ".concat(t.recResult[0].utterance,"?")}}))],on:{ENDSPEECH:{actions:Object(i.q)("LISTEN")}}},yes:{entry:Object(i.q)("COMPUTER_RIGHT")},no:{entry:Object(i.q)("COMPUTER_WRONG")},nomatch:{entry:p("I did not understand that. Please say, yes, or, no."),on:{ENDSPEECH:{actions:Object(i.q)("LISTEN")}}}}},set_username:{initial:"setup",on:{JUMP:"help_rules"},states:{setup:{entry:[Object(i.b)({username:function(t){return t.recResult[0].utterance}}),Object(i.q)((function(t){return{type:"SPEAK",value:"Nice to meet you, ".concat(t.username,".")}}))],on:{ENDSPEECH:{actions:Object(i.q)("JUMP")}}}}},help_rules:{initial:"setup",on:{JUMP:"who_starts"},states:{setup:{entry:p("The rules of this game are:\n                            You are allowed to pick 1 2 or 3 matches each turn.\n                            The winner is the one who takes the last matches.\n                            The game starts with 10 matches."),on:{ENDSPEECH:{actions:Object(i.q)("JUMP")}}}}},who_starts:{initial:"reset",on:{RECOGNISED:[{target:".helpme",cond:function(t){return"Help."===t.recResult[0].utterance}},{target:"unsure_of_who_starts",cond:function(t){return t.recResult[0].confidence<t.threshold}},{target:"intro",cond:function(t){return"isStarting"in(h[t.recResult[0].utterance]||{})},actions:[Object(i.b)({isStarting:function(t){return h[t.recResult[0].utterance].isStarting}})]},{target:".nomatch"}],HELPME:"login",TIMEOUT:[{target:"idle",cond:function(t){return t.sentenceCounter>=t.sentences.length}},{target:".prompt"}]},states:{reset:{entry:[Object(i.b)({numberOfMatches:function(t){return 10}}),Object(i.b)({maxPick:function(t){return 3}}),Object(i.b)({sentenceCounter:function(t){return 0}}),Object(i.b)({sentences:function(t){return["".concat(t.username,"! Who is going to start, you or me?"),"Which player is going to start, you or me?","Please say, you, if you want, me, to start or, I, if, you, want to start."]}})],always:"prompt"},helpme:{entry:p("You can create a meeting, or ask who is X."),on:{ENDSPEECH:{actions:Object(i.q)("HELPME")}}},prompt:{entry:[Object(i.q)((function(t){return{type:"SPEAK",value:t.sentences[t.sentenceCounter]}}))],on:{ENDSPEECH:{target:"select_whattodo",actions:Object(i.b)({sentenceCounter:function(t){return t.sentenceCounter+1}})}}},select_whattodo:{entry:Object(i.q)("LISTEN")},nomatch:{entry:p("Sorry, I don't know what it is."),on:{ENDSPEECH:"select_whattodo"}}}},unsure_of_who_starts:{initial:"first_question",on:{RECOGNISED:[{target:".yes",cond:function(t){return d(t.recResult[0].utterance)}},{target:".no",cond:function(t){return f(t.recResult[0].utterance)}},{target:".nomatch"}],COMPUTER_RIGHT:[{target:"intro",cond:function(t){return"isStarting"in(h[t.saved[0].utterance]||{})},actions:[Object(i.b)({isStarting:function(t){return h[t.saved[0].utterance].isStarting}})]},{target:"who_starts.nomatch",actions:[Object(i.b)({recResult:function(t){return t.saved}})]}],COMPUTER_WRONG:{target:"who_starts",actions:Object(i.b)({recResult:function(t){return t.saved}})},TIMEOUT:".repeat_question"},states:{first_question:{entry:Object(i.q)((function(t){return{type:"SPEAK",value:"Did you say: ".concat(t.recResult[0].utterance,"?")}})),on:{ENDSPEECH:{actions:[Object(i.q)("LISTEN"),Object(i.b)({saved:function(t){return t.recResult}})]}}},repeat_question:{entry:[Object(i.q)((function(t){return{type:"SPEAK",value:"Did you say: ".concat(t.saved[0].utterance,"?")}}))],on:{ENDSPEECH:{actions:Object(i.q)("LISTEN")}}},yes:{entry:Object(i.q)("COMPUTER_RIGHT")},no:{entry:Object(i.q)("COMPUTER_WRONG")},nomatch:{entry:p("I did not understand that. Please say, yes, or, no."),on:{ENDSPEECH:{actions:Object(i.q)("LISTEN")}}}}},intro:{initial:"start",on:{JUMP:[{target:"say_computer_starts",cond:function(t){return"computer"===t.isStarting}},{target:"say_player_starts",cond:function(t){return"player"===t.isStarting}},{target:"who_starts"}]},states:{start:{entry:[Object(i.q)("JUMP")]}}},say_computer_starts:{initial:"start",on:{JUMP:"computer_turn"},states:{start:{entry:p("Ok, I will start.\n                                We start with 10 matches."),on:{ENDSPEECH:{actions:Object(i.q)("JUMP")}}}}},say_computer_turn:{initial:"start",on:{ENDSPEECH:"computer_turn"},states:{start:{entry:p("it is now my turn.")}}},computer_turn:{initial:"start",on:{JUMP:[{cond:function(t){return 1===t.pickNumberOfMatches},actions:Object(i.q)((function(t){return{type:"SPEAK",value:"Hmmm... I will pick: ".concat(t.pickNumberOfMatches," match.")}}))},{actions:Object(i.q)((function(t){return{type:"SPEAK",value:"Hmmm... I will pick: ".concat(t.pickNumberOfMatches," matches.")}}))}],ENDSPEECH:"check_winner"},states:{start:{entry:[Object(i.b)({turn:function(t){return"computer"}}),Object(i.b)({pickNumberOfMatches:function(t){return e=1,n=t.maxPick,e=Math.ceil(e),n=Math.floor(n),Math.floor(Math.random()*(n-e+1))+e;var e,n}}),Object(i.q)("JUMP")]}}},say_player_starts:{initial:"start",on:{JUMP:"player_turn"},states:{start:{entry:Object(i.q)((function(t){return{type:"SPEAK",value:"Ok, you start, ".concat(t.username,".\n                                We start with 10 matches.")}})),on:{ENDSPEECH:{actions:Object(i.q)("JUMP")}}}}},say_player_turn:{initial:"start",on:{ENDSPEECH:"player_turn"},states:{start:{entry:[Object(i.q)((function(t){return{type:"SPEAK",value:"It is now your turn, ".concat(t.username,".")}}))]}}},player_can_pick_1:{initial:"start",on:{ENDSPEECH:"player_picks"},states:{start:{entry:p("You can take 1 match.")}}},player_can_pick_2:{initial:"start",on:{ENDSPEECH:"player_picks"},states:{start:{entry:p("Take 1 or 2 matches.")}}},player_can_pick_3:{initial:"start",on:{ENDSPEECH:"player_picks"},states:{start:{entry:p("Take 1, 2 or 3 matches.")}}},unsure_of_player_picks:{initial:"start",on:{ENDSPEECH:[{cond:function(t){return 1===t.maxPick},target:"player_can_pick_1"},{cond:function(t){return 2===t.maxPick},target:"player_can_pick_2"},{target:"player_can_pick_3"}]},states:{start:{entry:Object(i.q)((function(t){return{type:"SPEAK",value:"I did not understand your choice, ".concat(t.username,".")}}))}}},player_picks:{initial:"start",on:{RECOGNISED:[{target:"check_player_pick",cond:function(t){return"selectedMatches"in(h[t.recResult[0].utterance]||{})},actions:[Object(i.b)({selectedMatches:function(t){return h[t.recResult[0].utterance].selectedMatches}})]},{target:"unsure_of_player_picks"}]},states:{start:{entry:Object(i.q)("LISTEN")}}},check_player_pick:{initial:"start",on:{JUMP:[{target:"check_winner",cond:function(t){return t.maxPick>=1&&1===t.selectedMatches},actions:Object(i.b)({pickNumberOfMatches:function(t){return 1}})},{target:"check_winner",cond:function(t){return t.maxPick>=2&&2===t.selectedMatches},actions:Object(i.b)({pickNumberOfMatches:function(t){return 2}})},{target:"check_winner",cond:function(t){return 3===t.maxPick&&3===t.selectedMatches},actions:Object(i.b)({pickNumberOfMatches:function(t){return 3}})},{target:"wrong_pick"}]},states:{start:{entry:Object(i.q)("JUMP")}}},wrong_pick:{initial:"start",on:{JUMP:[{target:"player_can_pick_1",cond:function(t){return 1===t.selectedMatches},actions:Object(i.q)((function(t){return{type:"SPEAK",value:"You picked ".concat(t.selectedMatches," match but can only pick ").concat(t.maxPick,".")}}))},{target:"player_can_pick_2",cond:function(t){return 2===t.maxPick},actions:Object(i.q)((function(t){return{type:"SPEAK",value:"You picked ".concat(t.selectedMatches," matches but can only pick ").concat(t.maxPick,".")}}))},{target:"player_can_pick_3",actions:Object(i.q)((function(t){return{type:"SPEAK",value:"You picked ".concat(t.selectedMatches," matches but can only pick ").concat(t.maxPick,".")}}))}]},states:{start:{entry:Object(i.q)("JUMP")}}},player_turn:{initial:"start",on:{JUMP:[{target:"player_can_pick_1",cond:function(t){return 1===t.maxPick}},{target:"player_can_pick_2",cond:function(t){return 2===t.maxPick}},{target:"player_can_pick_3"}]},states:{start:{entry:[Object(i.b)({turn:function(t){return"player"}}),Object(i.q)("JUMP")]}}},check_winner:{initial:"start",on:{JUMP:[{target:"computer_wins",cond:function(t){return t.numberOfMatches<=0&&"computer"===t.turn}},{target:"player_wins",cond:function(t){return t.numberOfMatches<=0&&"player"===t.turn}},{target:"say_computer_turn",cond:function(t){return"player"===t.turn}},{target:"say_player_turn",cond:function(t){return"computer"===t.turn}}],SAY_MATCHES_LEFT:[{cond:function(t){return 1===t.numberOfMatches},actions:Object(i.q)((function(t){return{type:"SPEAK",value:"There is only ".concat(t.numberOfMatches," match left.")}}))},{actions:Object(i.q)((function(t){return{type:"SPEAK",value:"There are ".concat(t.numberOfMatches," matches left.")}}))}],ENDSPEECH:{actions:Object(i.q)("JUMP")}},states:{start:{entry:[Object(i.b)({numberOfMatches:function(t){return console.log("Number of Matches: "+t.numberOfMatches+"   Picking: "+t.pickNumberOfMatches),t.numberOfMatches-t.pickNumberOfMatches}}),Object(i.b)({maxPick:function(t){return t.numberOfMatches<3?t.numberOfMatches:3}}),Object(i.q)("SAY_MATCHES_LEFT")]}}},computer_wins:{initial:"start",on:{RECOGNISED:[{target:"who_starts",cond:function(t){return d(t.recResult[0].utterance)}},{target:"goodbye",cond:function(t){return f(t.recResult[0].utterance)}},{target:".nomatch"}]},states:{start:{entry:p("I won!\n                            Would you like a revenge?"),on:{ENDSPEECH:{actions:Object(i.q)("LISTEN")}}},nomatch:{entry:p("I did not understand that, please say yes or no."),on:{ENDSPEECH:{actions:Object(i.q)("LISTEN")}}}}},player_wins:{initial:"start",on:{RECOGNISED:[{target:"who_starts",cond:function(t){return d(t.recResult[0].utterance)}},{target:"goodbye",cond:function(t){return f(t.recResult[0].utterance)}},{target:".nomatch"}]},states:{start:{entry:Object(i.q)((function(t){return{type:"SPEAK",value:"Congratulations ".concat(t.username,"! You won!\n                                                Do you want to play another game?")}})),on:{ENDSPEECH:{actions:Object(i.q)("LISTEN")}}},nomatch:{entry:p("I did not understand that, please say yes or no."),on:{ENDSPEECH:{actions:Object(i.q)("LISTEN")}}}}},goodbye:{initial:"prompt",on:{ENDSPEECH:"init"},states:{prompt:{entry:p("Thank you for playing the game.")}}}}},m=n(160),b=n.n(m),y=n(163),O=n.n(y),g=n(12),_=s.a.send,S=s.a.cancel,k="northeurope";Object(l.a)({url:"https://statecharts.io/inspect",iframe:!1});var j=Object(o.a)({id:"root",type:"parallel",states:{dm:Object(a.a)({},E),asrtts:{initial:"init",states:{init:{on:{CLICK:{target:"getToken",actions:[Object(i.b)({audioCtx:function(t){return new(window.AudioContext||window.webkitAudioContext)}}),function(t){return navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){t.audioCtx.createMediaStreamSource(e)}))}]}}},getToken:{invoke:{id:"getAuthorizationToken",src:function(t,e){return T()},onDone:{actions:[Object(i.b)((function(t,e){return{azureAuthorizationToken:e.data}})),"ponyfillASR"],target:"ponyfillTTS"},onError:{target:"fail"}}},ponyfillTTS:{invoke:{id:"ponyTTS",src:function(t,e){return function(e,n){var c=O()({audioContext:t.audioCtx,credentials:{region:k,authorizationToken:t.azureAuthorizationToken}}),a=c.speechSynthesis,r=c.SpeechSynthesisUtterance;t.tts=a,t.ttsUtterance=r,t.tts.addEventListener("voiceschanged",(function(){t.tts.cancel();var n=t.tts.getVoices(),c=RegExp("en-US","u");c=RegExp("en-US","u");var a=n.find((function(t){return c.test(t.name)}));a?(t.voice=a,e("TTS_READY")):(console.error("TTS_ERROR: Could not get voice for regexp ".concat(c)),e("TTS_ERROR"))}))}}},on:{TTS_READY:"idle",TTS_ERROR:"fail"}},idle:{on:{LISTEN:"recognising",SPEAK:{target:"speaking",actions:Object(i.b)((function(t,e){return{ttsAgenda:e.value}}))}}},recognising:{initial:"noinput",exit:"recStop",on:{ASRRESULT:{actions:["recLogResult",Object(i.b)((function(t,e){return{recResult:e.value}}))],target:".match"},RECOGNISED:"idle",SELECT:"idle",CLICK:".pause"},states:{noinput:{entry:["recStart",_({type:"TIMEOUT"},{delay:function(t){return 1e3*(t.tdmPassivity||10)},id:"timeout"})],on:{TIMEOUT:"#root.asrtts.idle",STARTSPEECH:"inprogress"},exit:S("timeout")},inprogress:{},match:{entry:_("RECOGNISED")},pause:{entry:"recStop",on:{CLICK:"noinput"}}}},speaking:{entry:"ttsStart",on:{ENDSPEECH:"idle",SELECT:"idle",CLICK:{target:"idle",actions:_("ENDSPEECH")}},exit:"ttsStop"},fail:{}}}}},{actions:{recLogResult:function(t){console.log("U>",t.recResult[0].utterance,t.recResult[0].confidence)},logIntent:function(t){console.log("<< NLU intent: "+t.nluData.intent.name)}}}),M=function(t){var e=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"name"===t.attribute}))||{}).value,n=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"image"===t.attribute}))||{}).value,c="circle";switch(!0){case t.state.matches({asrtts:"fail"})||t.state.matches({dm:"fail"}):break;case t.state.matches({asrtts:{recognising:"pause"}}):e="Click to continue";break;case t.state.matches({asrtts:"recognising"}):c="circle-recognising",e=e||"Listening...";break;case t.state.matches({asrtts:"speaking"}):c="circle-speaking",e=e||"Speaking...";break;case t.state.matches({dm:"idle"}):case t.state.matches({dm:"init"}):e="Click to start!",c="circle-click";break;default:e=e||"\xa0"}return Object(g.jsxs)("div",{className:"control",children:[Object(g.jsx)("figure",{className:"prompt",children:n&&Object(g.jsx)("img",{src:n,alt:e})}),Object(g.jsxs)("div",{className:"status",children:[Object(g.jsx)("button",Object(a.a)({type:"button",className:c,style:{}},t)),Object(g.jsx)("div",{className:"status-text",children:e})]})]})},P=function(t){var e=t.alternative.find((function(t){return"name"===t.attribute})).value,n=(t.alternative.find((function(t){return"image"===t.attribute}))||{}).value;return Object(g.jsxs)("figure",Object(a.a)(Object(a.a)({className:"flex"},t),{},{children:[n&&Object(g.jsx)("img",{src:n,alt:e}),Object(g.jsx)("figcaption",{children:e})]}))};function C(){var t=Object(u.b)(j,{devTools:!0,actions:{changeColour:Object(u.a)((function(t){document.body.style.background=t.recResult[0].utterance})),recStart:Object(u.a)((function(t){t.asr.start()})),recStop:Object(u.a)((function(t){t.asr.abort()})),ttsStart:Object(u.a)((function(t){var e=new t.ttsUtterance(t.ttsAgenda);console.log("S>",t.ttsAgenda),e.voice=t.voice,e.onend=function(){return a("ENDSPEECH")},t.tts.speak(e)})),ttsStop:Object(u.a)((function(t){t.tts.cancel()})),ponyfillASR:Object(u.a)((function(t,e){var n=b()({audioContext:t.audioCtx,credentials:{region:k,authorizationToken:t.azureAuthorizationToken}}).SpeechRecognition;t.asr=new n,t.asr.lang="en-US",t.asr.continuous=!0,t.asr.interimResults=!0,t.asr.onresult=function(t){var e=t.results[0];e.isFinal?a({type:"ASRRESULT",value:[{utterance:e[0].transcript,confidence:e[0].confidence}]}):a({type:"STARTSPEECH"})}}))}}),e=Object(c.a)(t,2),n=e[0],a=e[1],r=(n.context.tdmExpectedAlternatives||[]).filter((function(t){return t.visual_information})).map((function(t,e){return Object(g.jsx)(P,{state:n,alternative:t.visual_information,onClick:function(){return a({type:"SELECT",value:t.semantic_expression})}},e)}));return Object(g.jsxs)("div",{className:"App",children:[Object(g.jsx)(M,{state:n,alternative:{},onClick:function(){return a("CLICK")}}),Object(g.jsx)("div",{className:"select-wrapper",children:Object(g.jsx)("div",{className:"select",children:r})})]})}var T=function(){return fetch(new Request("https://northeurope.api.cognitive.microsoft.com/sts/v1.0/issuetoken",{method:"POST",headers:{"Ocp-Apim-Subscription-Key":"6dbf9445e02f4309ad110935a537bd83"}})).then((function(t){return t.text()}))},N=document.getElementById("root");r.render(Object(g.jsx)(C,{}),N)}},[[456,1,2]]]);
//# sourceMappingURL=main.2c183723.chunk.js.map