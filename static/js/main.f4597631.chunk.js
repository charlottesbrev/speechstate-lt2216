(this.webpackJsonpspeechstate=this.webpackJsonpspeechstate||[]).push([[0],{170:function(t,e,n){},218:function(t,e){},357:function(t,e){},360:function(t,e){},364:function(t,e){},365:function(t,e){},366:function(t,e){},367:function(t,e){},368:function(t,e){},456:function(t,e,n){"use strict";n.r(e);var o=n(166),a=n(51),r=(n(170),n(14),n(159)),i=n(25),c=n(94),s=n(3),u=n(459),l=n(460);function d(t){return Object(s.q)((function(e){return{type:"SPEAK",value:t}}))}var m={Lab:{title:"Laboration"},"Lecture.":{title:"Dialogue systems lecture"},"Exam.":{title:"Exam at the university"},"On Monday.":{day:"Monday"},"On Tuesday.":{day:"Tuesday"},"On Wednesday.":{day:"Wednesday"},"On Thirsday.":{day:"Thirsday"},"On Friday.":{day:"Friday"},"On Saturday.":{day:"Saturday"},"On Sunday.":{day:"Sunday"},"At 8:00":{time:"08:00"},"At 9:00":{time:"09:00"},"At 10":{time:"10:00"},"At 11":{time:"11:00"},"At 12":{time:"12:00"},"At 13":{time:"13:00"},"At 14":{time:"14:00"},"At 15":{time:"15:00"},"At 16":{time:"16:00"},"Yes.":{acknowledge:"Yes"},"No.":{acknowledge:"No"},"Of course.":{acknowledge:"Yes"},"No way.":{acknowledge:"No"}};function E(t){return t.startsWith("Who is ")&&t.endsWith("?")?t.substring(7,t.length-1):""}var y={initial:"idle",states:{idle:{on:{CLICK:"init"}},init:{on:{TTS_READY:"login",CLICK:"login"}},login:{initial:"prompt",on:{RECOGNISED:[{target:"ask_whattodo",actions:Object(s.b)({username:function(t){return t.recResult[0].utterance}})},{target:".nomatch"}],TIMEOUT:".prompt"},states:{prompt:{entry:d("What is your name?"),on:{ENDSPEECH:"login_user"}},login_user:{entry:Object(s.q)("LISTEN")},nomatch:{entry:d("Sorry, I don't know what it is. Tell me your name."),on:{ENDSPEECH:"login_user"}}}},ask_whattodo:{initial:"prompt",on:{RECOGNISED:[{target:"intro",cond:function(t){return"Create a meeting."===t.recResult[0].utterance}},{target:"check_whois",cond:function(t){return""!=E(t.recResult[0].utterance)},actions:Object(s.b)({name:function(t){return E(t.recResult[0].utterance)}})},{target:".nomatch"}],TIMEOUT:".prompt"},states:{prompt:{entry:Object(s.q)((function(t){return{type:"SPEAK",value:"Hi, ".concat(t.username,"! What do you want to do? You can create a meeting, or ask who is X.")}})),on:{ENDSPEECH:"select_whattodo"}},select_whattodo:{entry:Object(s.q)("LISTEN")},nomatch:{entry:d("Sorry, I don't know what it is."),on:{ENDSPEECH:"select_whattodo"}}}},check_whois:{initial:"get_result",on:{RECOGNISED:[{target:"info_meeting",cond:function(t){return"Yes."===(e=t.recResult[0].utterance)||"Of course."===e;var e},actions:Object(s.b)({title:function(t){return"Meeting with ".concat(t.name)}})},{target:"ask_whattodo",cond:function(t){return"No."===(e=t.recResult[0].utterance)||"No way."===e;var e}},{target:".nomatch"}],TIMEOUT:".get_result"},states:{get_result:{entry:d(""),on:{ENDSPEECH:"tell_result"}},tell_result:{entry:Object(s.q)((function(t){return{type:"SPEAK",value:"".concat(t.name," is 1 2 3 ... Do you want to meet them?")}})),on:{ENDSPEECH:"select_whattodo"}},select_whattodo:{entry:Object(s.q)("LISTEN")},nomatch:{entry:d("Sorry, I don't know what it is. Say yes or no."),on:{ENDSPEECH:"select_whattodo"}}}},intro:{initial:"prompt",on:{ENDSPEECH:"welcome"},states:{prompt:{entry:d("Let's create a meeting")}}},welcome:{initial:"prompt",on:{RECOGNISED:[{target:"info_meeting",cond:function(t){return"title"in(m[t.recResult[0].utterance]||{})},actions:Object(s.b)({title:function(t){return m[t.recResult[0].utterance].title}})},{target:".nomatch"}],TIMEOUT:".prompt"},states:{prompt:{entry:d("What is it about?"),on:{ENDSPEECH:"ask_meeting"}},ask_meeting:{entry:Object(s.q)("LISTEN")},nomatch:{entry:d("Sorry, I don't know what it is. Tell me something I know."),on:{ENDSPEECH:"ask_meeting"}}}},info_meeting:{entry:Object(s.q)((function(t){return{type:"SPEAK",value:"OK, ".concat(t.title)}})),on:{ENDSPEECH:"weekday"}},weekday:{initial:"prompt",on:{RECOGNISED:[{target:"info_weekday",cond:function(t){return"day"in(m[t.recResult[0].utterance]||{})},actions:Object(s.b)({day:function(t){return m[t.recResult[0].utterance].day}})},{target:".nomatch"}],TIMEOUT:".prompt"},states:{prompt:{entry:d("On which day is it?"),on:{ENDSPEECH:"ask_day"}},ask_day:{entry:Object(s.q)("LISTEN")},nomatch:{entry:d("Sorry, I don't know what it is. Tell me a weekday."),on:{ENDSPEECH:"ask_day"}}}},info_weekday:{entry:Object(s.q)((function(t){return{type:"SPEAK",value:"OK, ".concat(t.day)}})),on:{ENDSPEECH:"wholeday"}},wholeday:{initial:"prompt",on:{RECOGNISED:[{target:"info_wholeday",cond:function(t){return"acknowledge"in(m[t.recResult[0].utterance]||{})},actions:Object(s.b)({acknowledge:function(t){return m[t.recResult[0].utterance].acknowledge}})},{target:".nomatch"}],TIMEOUT:".prompt"},states:{prompt:{entry:d("Will it take the whole day?"),on:{ENDSPEECH:"waitfor_yesno"}},waitfor_yesno:{entry:Object(s.q)("LISTEN")},nomatch:{entry:d("Sorry, I don't know what it is. Tell me a yes or a no."),on:{ENDSPEECH:"waitfor_yesno"}}}},info_wholeday:{entry:Object(s.q)((function(t){return{type:"SPEAK",value:"OK, ".concat(t.acknowledge)}})),on:{ENDSPEECH:[{target:"meeting_wholeday",cond:function(t){return"Yes"===t.acknowledge}},{target:"timeofday",cond:function(t){return"No"===t.acknowledge}}]}},meeting_wholeday:{initial:"prompt",on:{RECOGNISED:[{target:"info_meeting_wholeday",cond:function(t){return"acknowledge"in(m[t.recResult[0].utterance]||{})},actions:Object(s.b)({acknowledge:function(t){return m[t.recResult[0].utterance].acknowledge}})},{target:".nomatch"}],TIMEOUT:".prompt"},states:{prompt:{entry:Object(s.q)((function(t){return{type:"SPEAK",value:"Do you want me to create a meeting titled ".concat(t.title," on ").concat(t.day," for the whole day?")}})),on:{ENDSPEECH:"waitfor_yesno"}},waitfor_yesno:{entry:Object(s.q)("LISTEN")},nomatch:{entry:d("Sorry, I don't know what it is. Tell me a yes or a no."),on:{ENDSPEECH:"waitfor_yesno"}}}},info_meeting_wholeday:{entry:Object(s.q)((function(t){return{type:"SPEAK",value:"OK, ".concat(t.acknowledge)}})),on:{ENDSPEECH:[{target:"done",cond:function(t){return"Yes"===t.acknowledge}},{target:"welcome",cond:function(t){return"No"===t.acknowledge}}]}},timeofday:{initial:"prompt",on:{RECOGNISED:[{target:"info_timeofday",cond:function(t){return"time"in(m[t.recResult[0].utterance]||{})},actions:Object(s.b)({time:function(t){return m[t.recResult[0].utterance].time}})},{target:".nomatch"}],TIMEOUT:".prompt"},states:{prompt:{entry:d("What time is your meeting?"),on:{ENDSPEECH:"ask_time"}},ask_time:{entry:Object(s.q)("LISTEN")},nomatch:{entry:d("Sorry, I don't know what hour that is. Tell me an hour."),on:{ENDSPEECH:"ask_time"}}}},info_timeofday:{entry:Object(s.q)((function(t){return{type:"SPEAK",value:"OK, ".concat(t.time)}})),on:{ENDSPEECH:"meeting_time"}},meeting_time:{initial:"prompt",on:{RECOGNISED:[{target:"info_meeting_time",cond:function(t){return"acknowledge"in(m[t.recResult[0].utterance]||{})},actions:Object(s.b)({acknowledge:function(t){return m[t.recResult[0].utterance].acknowledge}})},{target:".nomatch"}],TIMEOUT:".prompt"},states:{prompt:{entry:Object(s.q)((function(t){return{type:"SPEAK",value:"Do you want me to create a meeting titled ".concat(t.title," on ").concat(t.day," at ").concat(t.time,"?")}})),on:{ENDSPEECH:"waitfor_yesno"}},waitfor_yesno:{entry:Object(s.q)("LISTEN")},nomatch:{entry:d("Sorry, I don't know what it is. Tell me a yes or a no."),on:{ENDSPEECH:"waitfor_yesno"}}}},info_meeting_time:{entry:Object(s.q)((function(t){return{type:"SPEAK",value:"OK, ".concat(t.acknowledge)}})),on:{ENDSPEECH:[{target:"done",cond:function(t){return"Yes"===t.acknowledge}},{target:"welcome",cond:function(t){return"No"===t.acknowledge}}]}},done:{initial:"prompt",states:{prompt:{entry:d("Your meeting has been created"),on:{ENDSPEECH:"stop"}},stop:{type:"final"}}}}},f=n(160),g=n.n(f),p=n(163),S=n.n(p),h=n(12),O=i.a.send,w=i.a.cancel,b="northeurope";Object(l.a)({url:"https://statecharts.io/inspect",iframe:!1});var k=Object(c.a)({id:"root",type:"parallel",states:{dm:Object(a.a)({},y),asrtts:{initial:"init",states:{init:{on:{CLICK:{target:"getToken",actions:[Object(s.b)({audioCtx:function(t){return new(window.AudioContext||window.webkitAudioContext)}}),function(t){return navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){t.audioCtx.createMediaStreamSource(e)}))}]}}},getToken:{invoke:{id:"getAuthorizationToken",src:function(t,e){return N()},onDone:{actions:[Object(s.b)((function(t,e){return{azureAuthorizationToken:e.data}})),"ponyfillASR"],target:"ponyfillTTS"},onError:{target:"fail"}}},ponyfillTTS:{invoke:{id:"ponyTTS",src:function(t,e){return function(e,n){var o=S()({audioContext:t.audioCtx,credentials:{region:b,authorizationToken:t.azureAuthorizationToken}}),a=o.speechSynthesis,r=o.SpeechSynthesisUtterance;t.tts=a,t.ttsUtterance=r,t.tts.addEventListener("voiceschanged",(function(){t.tts.cancel();var n=t.tts.getVoices(),o=RegExp("en-US","u");o=RegExp("en-US","u");var a=n.find((function(t){return o.test(t.name)}));a?(t.voice=a,e("TTS_READY")):(console.error("TTS_ERROR: Could not get voice for regexp ".concat(o)),e("TTS_ERROR"))}))}}},on:{TTS_READY:"idle",TTS_ERROR:"fail"}},idle:{on:{LISTEN:"recognising",SPEAK:{target:"speaking",actions:Object(s.b)((function(t,e){return{ttsAgenda:e.value}}))}}},recognising:{initial:"noinput",exit:"recStop",on:{ASRRESULT:{actions:["recLogResult",Object(s.b)((function(t,e){return{recResult:e.value}}))],target:".match"},RECOGNISED:"idle",SELECT:"idle",CLICK:".pause"},states:{noinput:{entry:["recStart",O({type:"TIMEOUT"},{delay:function(t){return 1e3*(t.tdmPassivity||10)},id:"timeout"})],on:{TIMEOUT:"#root.asrtts.idle",STARTSPEECH:"inprogress"},exit:w("timeout")},inprogress:{},match:{entry:O("RECOGNISED")},pause:{entry:"recStop",on:{CLICK:"noinput"}}}},speaking:{entry:"ttsStart",on:{ENDSPEECH:"idle",SELECT:"idle",CLICK:{target:"idle",actions:O("ENDSPEECH")}},exit:"ttsStop"},fail:{}}}}},{actions:{recLogResult:function(t){console.log("U>",t.recResult[0].utterance,t.recResult[0].confidence)},logIntent:function(t){console.log("<< NLU intent: "+t.nluData.intent.name)}}}),T=function(t){var e=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"name"===t.attribute}))||{}).value,n=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"image"===t.attribute}))||{}).value,o="circle";switch(!0){case t.state.matches({asrtts:"fail"})||t.state.matches({dm:"fail"}):break;case t.state.matches({asrtts:{recognising:"pause"}}):e="Click to continue";break;case t.state.matches({asrtts:"recognising"}):o="circle-recognising",e=e||"Listening...";break;case t.state.matches({asrtts:"speaking"}):o="circle-speaking",e=e||"Speaking...";break;case t.state.matches({dm:"idle"}):case t.state.matches({dm:"init"}):e="Click to start!",o="circle-click";break;default:e=e||"\xa0"}return Object(h.jsxs)("div",{className:"control",children:[Object(h.jsx)("figure",{className:"prompt",children:n&&Object(h.jsx)("img",{src:n,alt:e})}),Object(h.jsxs)("div",{className:"status",children:[Object(h.jsx)("button",Object(a.a)({type:"button",className:o,style:{}},t)),Object(h.jsx)("div",{className:"status-text",children:e})]})]})},j=function(t){var e=t.alternative.find((function(t){return"name"===t.attribute})).value,n=(t.alternative.find((function(t){return"image"===t.attribute}))||{}).value;return Object(h.jsxs)("figure",Object(a.a)(Object(a.a)({className:"flex"},t),{},{children:[n&&Object(h.jsx)("img",{src:n,alt:e}),Object(h.jsx)("figcaption",{children:e})]}))};function C(){var t=Object(u.b)(k,{devTools:!0,actions:{changeColour:Object(u.a)((function(t){document.body.style.background=t.recResult[0].utterance})),recStart:Object(u.a)((function(t){t.asr.start()})),recStop:Object(u.a)((function(t){t.asr.abort()})),ttsStart:Object(u.a)((function(t){var e=new t.ttsUtterance(t.ttsAgenda);console.log("S>",t.ttsAgenda),e.voice=t.voice,e.onend=function(){return a("ENDSPEECH")},t.tts.speak(e)})),ttsStop:Object(u.a)((function(t){t.tts.cancel()})),ponyfillASR:Object(u.a)((function(t,e){var n=g()({audioContext:t.audioCtx,credentials:{region:b,authorizationToken:t.azureAuthorizationToken}}).SpeechRecognition;t.asr=new n,t.asr.lang="en-US",t.asr.continuous=!0,t.asr.interimResults=!0,t.asr.onresult=function(t){var e=t.results[0];e.isFinal?a({type:"ASRRESULT",value:[{utterance:e[0].transcript,confidence:e[0].confidence}]}):a({type:"STARTSPEECH"})}}))}}),e=Object(o.a)(t,2),n=e[0],a=e[1],r=(n.context.tdmExpectedAlternatives||[]).filter((function(t){return t.visual_information})).map((function(t,e){return Object(h.jsx)(j,{state:n,alternative:t.visual_information,onClick:function(){return a({type:"SELECT",value:t.semantic_expression})}},e)}));return Object(h.jsxs)("div",{className:"App",children:[Object(h.jsx)(T,{state:n,alternative:{},onClick:function(){return a("CLICK")}}),Object(h.jsx)("div",{className:"select-wrapper",children:Object(h.jsx)("div",{className:"select",children:r})})]})}var N=function(){return fetch(new Request("https://northeurope.api.cognitive.microsoft.com/sts/v1.0/issuetoken",{method:"POST",headers:{"Ocp-Apim-Subscription-Key":"6dbf9445e02f4309ad110935a537bd83"}})).then((function(t){return t.text()}))},_=document.getElementById("root");r.render(Object(h.jsx)(C,{}),_)}},[[456,1,2]]]);
//# sourceMappingURL=main.f4597631.chunk.js.map